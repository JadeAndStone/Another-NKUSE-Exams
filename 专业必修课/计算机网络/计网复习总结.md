# 计网复习总结

1.计算机网络（师老师）
补充（曾老师）：1.IP协议内容、IPV4字节、子网掩码、IP地址
2.三次握手的过程（示意图，保证可靠性是哪一层）
3.五层顺序、内容（协议）、功能以及交互（比如考你判断协议是哪一层）
4.检验码的计算，掌握能检验的原因
5.网络层路由协议算法（画每一步的表格）
6.可靠传输协议rdt1.0 2.0 3.0（去年的最后一题画图题 30分）

7. 病毒、蠕虫的含义；如何保护我们的计算机
    8.日常上网中（如打开GOOGLE浏览器进行搜索）我们一共使用了哪些协议以及这些协议的作用是什么以及各种协议之间的交互
8. TCP/UDP来自哪一层，他们的内容是什么，优缺点分别是什么。UDP、TCP之间的联系和区别                                                                                                                                                                            
    10.ISP：全球ISP、地区ISP
9. IP、Mac地址的联系、区别，功能。两者分别能干嘛
   12.链路层ARP可以重点看一下
   12.去年确定不考的：计算机网络黑皮书1.7、2.24、2.5、2.6、2.7、6.44、第七章后不考

## 整体理解补充

### TCP/IP协议栈

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104131214852.png" alt="image-20220104131214852" style="zoom:50%;" />

### 数据在计算机网络中的传输过程

![image-20220104165841343](C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104165841343.png)

## ✨第一章 引言

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220101223200020.png" alt="image-20220101223200020" style="zoom: 33%;" />

### 协议与分层结构

#### 协议设计目的

网络协议：为进行网络中的数据交换而建立的规则或约定，即网络协议

三要素：语法、语义、时序

#### 协议分层结构

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220101222829111.png" alt="image-20220101222829111" style="zoom: 33%;" />

层次栈：每一层都使用下一层提供的服务，并为上层提供自己的服务

对等实体：不同机器上构成相应层次的实体称为对等实体

接口：相邻层次之间的是接口，定义了下层向上层提供的服务原语

网络体系结构：层和协议的集合称为网络体系结构，一个特定的系统所使用的一组协议，即每一层的协议，称为协议栈

#### 六个核心服务原语

连接请求

接收响应

请求数据

应答

请求断开

断开连接

#### 服务与协议的关系

协议是“水平”的，服务是“垂直”的

实体使用协议来定义其实现的服务

上层实体通过接口来使用下层实体的服务

![image-20220101224415878](C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220101224415878.png)

### 参考模型

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220101224723391.png" alt="image-20220101224723391" style="zoom:50%;" />

### 计算机网络度量单位（了解）

**比特率**

bit/s，主机在数字信道上传送数据的速率

往往是指额定速率或标称速率

**带宽**

bit/s，单位时间内网络中的某信道所能通过的**“最高数据率”**

**包转发率（PPS-Packet Per Send）**

交换机或路由器等网络设备以包为单位的转发速率

**时延（Delay）**

数据从网络的一端传送到另一端所需的时间

传输时延、传播时延、处理时延、排队时延

**往返时延（RTT）**

从发送方发送数据开始，到发送方收到来自接收方确认经历的总时间

**时延带宽积**

按bit计数的链路长度

**吞吐量**

单位时间内通过某个网络（或信道、接口）的数据量，b/s

相对于带宽而言，**是实测数据**

**有效吞吐量**

单位时间内，目的地正确接收到的有用信息的数目

**利用率**

信道利用率指出某信道有百分之几的时间是被利用的

网络利用率则是全网络的信道利用率的加权平均值

**丢包率**

所丢失数据包的数量占所发送数据包的比率

**时延抖动**

**变化的时延**

**延迟丢包**

由于数据包延迟到达，在接收端需要丢弃失去使用价值的包

## ✨第二章 物理层

### 物理层基本概念

#### 物理层功能

**位置：**物理层是网络体系结构中的最底层

是连接计算机的具体物理设备吗？**不是**

是负责信号传输的具体物理媒体吗？**不是**

**功能：**数据链路层将数据比特流传送给物理层->物理层将比特流按照传输媒体的需要进行编码->然后将信号通过传输媒体传输到下一个节点的物理层

**作用：**尽可能地**屏蔽掉不同传输媒体和通信手段的差异**

#### 物理层特性

**接口特性**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102104755600.png" alt="image-20220102104755600" style="zoom: 50%;" />

DTE：数据终端设备

DCE：数据电路终结设备，在DTE和传输线路之间提供信号变换和编码的功能         

标准化的DTE/DCE接口具有机械特性、电气特性、功能特性、过程特性

物理层协议是DTE和DCE之间的约定，规定了两者之间的接口特性

**机械特性**

设计接口的物理结构，通常采用接线器来实现机械上的连接

定义接线器的形状和尺寸、引线数目和排列等

**电气特性**                            

规定了DTE/DCE之间多条信号线的电气连接以及有关电路特性

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102110012696.png" alt="image-20220102110012696" style="zoom:50%;" /> 

**功能特性**

描述接口执行的功能，定义接线器每一引脚的作用

**过程特性**

指明对于不同功能的各种可能事件的出现顺序

#### 物理层常用标准

传统以太网IEEE 802.3：**10BASE-T**等

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102111137475.png" alt="image-20220102111137475" style="zoom: 67%;" />                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           

### 多路复用技术

**复用技术的目的**

允许用户使用一个共享信道进行通信，避免相互干扰，降低成本，提高利用率

#### 频分复用

将整个带宽分为多份，**所有用户在同样的时间占用不同的带宽资源**

#### **时分复用**

将时间划分为一段段等长的时分复用帧

存在的不足：使用时分复用系统传送计算机数据时，由于计算机数据的突发性质，用户对分配到的子信道利用率一般是不高的

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102111906304.png" alt="image-20220102111906304" style="zoom: 67%;" />

#### 统计时分复用

动态地按需分配共用信道的间隙，只将需要传送数据的终端接入共用信道，以提高信道利用率的多路复用技术。

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102112042131.png" alt="image-20220102112042131" style="zoom: 67%;" />

#### 波分复用

利用多个激光器在单条光纤上同时发送多束不同波长激光的技术

波分复用就是光的频分复用

#### 码分复用

利用码序列相关性实现的多址通信，基本思想是靠不同的地址码来区分的地址

**这种系统发送的信号有很强的抗干扰能力，其频率类似与白噪声，不易被敌人发现**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102112628045.png" alt="image-20220102112628045" style="zoom: 50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102135714712.png" alt="image-20220102135714712" style="zoom: 33%;" />

#### 🍒 码分复用例题

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102135522780.png" alt="image-20220102135522780" style="zoom:50%;" />

## ✨第三章 数据链路层

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102140321340.png" alt="image-20220102140321340" style="zoom:50%;" />

### 数据链路层的设计问题

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102140612702.png" alt="image-20220102140612702" style="zoom:50%;" />

#### **数据链路层的功能**

向下：利用物理层提供的位流服务

向上：向网络层提供明确的服务接口

**成帧：**将比特流划分成“帧”，检测和纠正物理层在比特传输中可能出现的错误，数据链路层功能需借助“帧”的各个域来实现

**差错控制**

**流量控制**

### 差错检测和纠正

#### 海明距离

两个码字之间不同对应比特的数目：

0000000000和0000011111的海明距离为5

为了检查出d个错（比特错），可以使用海明距离为 **d+1** 的编码

为了纠正d个错，可以使用海明距离为 **2d+1** 的编码

（对纠错码的理解：纠错的目的是为了让检测出差错的编码，**这里出现差错的编码也就是与目标编码不符的非法编码**，变回它改变前的合法编码，而在海明距离是2d+1时，如果出现d位差错，它只需要d位改变就可变回合法编码，一旦出现d+1位差错，数据也会想要通过d位改变成为合法编码，但此合法编码并非之前我们想要的编码，所以2d+1的海明距离只能纠正d个错误）

#### 检错码

##### 奇偶检验

##### 校验和

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102143125914.png" alt="image-20220102143125914" style="zoom:50%;" />

##### ❗🍒循环冗余检验(CRC)例题

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102143336300.png" alt="image-20220102143336300" style="zoom:50%;" />

#### 纠错码

海明码（了解基本思想即可）

### 基本的数据链路层协议

#### 关键假设

分层独立假设

提供可靠服务假设

只处理通信错误假设

#### 乌托邦式单工协议

单工：数据单向传输

完美信道

始终就绪

瞬间完成

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102150424036.png" alt="image-20220102150424036" style="zoom:50%;" />

#### 无错信道上的停等协议（掌握核心思想即可）

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102150537264.png" alt="image-20220102150537264" style="zoom:50%;" />

**核心思想：**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102150654050.png" alt="image-20220102150654050" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102150900949.png" alt="image-20220102150900949" style="zoom:50%;" />

#### 有错信道上的单工停等协议

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102150812376.png" alt="image-20220102150812376" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102150831919.png" alt="image-20220102150831919" style="zoom:50%;" />

**比无错信道增加了一个计时器**

### 滑动窗口协议

#### 基本思想

**目的**

可以对连续发出的最多帧数**（已发出但未确认的帧）**作限制

**序号使用**

循环重复使用有限的帧序号

**流量控制**

WT：发送窗口，表示在收到对方确认的信息之前，可以连续发出的最多数据帧数

WR：接收窗口，可以连续接收的最多数据帧数

**累计确认**

不必对收到的分组逐个发送确认，而是对按序到达的最后一个分组发送确认

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102151418103.png" alt="image-20220102151418103" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220102151519194.png" alt="image-20220102151519194" style="zoom:50%;" />

#### ❗回退N协议(BGN)

出错或丢失全部重发

**适用场景**

对应**接收窗口为1**的情况，即只能按顺序接收帧

**优点**

连续发送提高了信道利用率

**缺点**

按序接收，出错后即便有正确帧到达也丢弃重传

#### ❗选择重传协议(SR)

只重传出错帧或计时器超时的数据帧

**适用场景**

对应**接收窗口大于1**的情况，即暂存接收窗口中序号在出错之后的数据帧

**优点**

避免重传已正确传送的帧

**缺点**

在接收端需要占用一定容量的缓存

（对比回退N而言相当于“用空间换时间”）

## ✨第四章 介质访问子层

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220103214709993.png" alt="image-20220103214709993" style="zoom:50%;" />

### MAC子层的位置

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220103214814075.png" alt="image-20220103214814075" style="zoom:50%;" />

### 信道分配问题

#### 局域网信道

点到点

多点：逻辑拓扑是总线式的，信道是共享的

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220103214948160.png" alt="image-20220103214948160" style="zoom:50%;" />

#### ❗常见的局域网拓扑

**总线拓扑、星型拓扑、环型拓扑**

共同点：共享一根信道（别称：广播信道、多路访问信道、随机访问信道）

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220103215114044.png" alt="image-20220103215114044" style="zoom:50%;" />

### 多路访问协议

#### 三大多路访问协议及小分类

![image-20220103215304510](C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220103215304510.png)

#### ❗ALOHA协议

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220103220241764.png" alt="image-20220103220241764" style="zoom: 33%;" />

**纯ALOHA**

任性！

原理：想发就发

特点：

冲突：两个或以上的帧

随时可能冲突

冲突的帧完全破坏

破坏了的帧要重传

**分隙ALOHA**

把时间分成时槽（时隙）

时隙的长度对应一帧的传输时间

帧的发送必须在时隙的起点

冲突只能发生在时隙的起点

#### ❗CSMA(载波侦听多路访问协议)

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220103220307494.png" alt="image-20220103220307494" style="zoom:50%;" />

不再任性，变得礼貌了！

特点：先听后发

**非持续式CSMA**

特点：

1. 经侦听，如果介质空闲，开始发送
2. 如果介质忙，则等待一个随机分布的时间，然后重复步骤1

优点：

等待一个随机时间可以减少再次碰撞冲突的可能性

缺点：

等待时间内介质上如果没有数据传送，这段时间是浪费的

**CSMA/CD(1-持续)**

原理：“先听后发、边发边听”

过程：

1. 经侦听，如介质空闲，则发送
2. 如介质忙，**持续侦听**，一旦空闲立即发送
3. 如果发生冲突，等待一个随机分布的时间再重复步骤1

概念模型：

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220103222100689.png" alt="image-20220103222100689" style="zoom:50%;" />

传输周期：一个站点使用信道，其他站点禁止使用

竞争周期：所有站点都有权尝试使用信道，争用时间槽

空闲周期：所有站点都不使用信道

缺点：依然会在两种情况下发生冲突（同时传送；传播延迟时间）

**p-持续式CSMA**

特点

1. 经侦听，如介质空闲，那么以p的概率发送，以（1-p）的概率延迟一个时间单元发送

2. 如介质忙，持续侦听，一旦空闲重复1

3. 如果发送已推迟一个时间单元，再重复步骤1

   **（1-持续式是p-持续式的特例）**

**各种CSMA的性能比较**

以太网采用了CSMA/CD

吞吐量：比ALOHA高，比P-持续式CSMA低

冲突：比ALOHA少，比P-持续式CSMA高

P-持续式付出了高延迟的代价

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220103223122986.png" alt="image-20220103223122986" style="zoom: 50%;" />

#### 受控访问协议

**位图协议：**

竞争期在自己的时槽内发送竞争比特

举手示意 资源预留 

传输期按序发送

明确的使用权，避免了冲突

**令牌：**

发送工作站去抓取，获得发送权

维护代价高

**二进制倒计数协议：**

站点：编序号，序号长度相同

竞争期：有数据发送的站点从高序号到低序号排队，高者得到发送权

特点：高序号站点优先

#### 自适应树

在一次成功传输后的第一个竞争间隙，所有站点同时竞争

如果只有一个站点申请，则获得信道

否则在下一竞争时隙，有一半站点参与竞争（递归），下一时隙由另一半站点参与竞争

及所有站点构成一棵完全二叉树

### ❗以太网（核心）

#### **经典以太网**

**物理层（❗拓扑）**

最高速率10Mbps

使用曼彻斯特编码

使用同轴电缆核中继器连接

常用两种标准：

DIX Ethernet V2(最常用)

IEEE 的802.3标准

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104104409478.png" alt="image-20220104104409478" style="zoom:50%;" />

**MAC子层协议（❗帧结构）**

硬件地址又称为物理地址，或MAC地址

MAC帧中的源地址核目的地址长度均为6字节

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104093733324.png" alt="image-20220104093733324" style="zoom:50%;" />

#### ❗交换式以太网

核心：交换机

工作在数据链路层，检查MAC帧的目的地址对收到的帧进行转发

交换及通过高速背板把帧传送到目标端口

#### 快速以太网

fast Ethernet(IEEE)

带宽 10Mbps->100Mbps **（不是最快的以太网->后面又出现了千兆以太网）**

保留了原来的工作方式（帧格式、接口、过程规则）

自动协商

线缆类型

#### 千兆以太网

gigabit Ethernet(IEEE)

1000Mbps

保留了原来的工作方式（帧格式、接口、过程规则）

全双工和半双工两种方式工作

​	在半双工方式下使用CSMA/CD（为了向后兼容），增加载波扩充和帧突发

​	全双工方式不需要使用CSMA/CD（缺省方式）

流量控制和巨型帧

#### 万兆以太网

10-Gigabit Ethernet(IEEE)

10Gbps

常记为10GE,10BbE或10GigE

只支持全双工，不再使用CSMA/CD

保持兼容性

重点是超高速的物理层

### 数据链路层交换

#### 数据链路层交换原理

**物理层设备扩充网络**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104102103585.png" alt="image-20220104102103585" style="zoom:50%;" />

扩大了冲突域，性能降低，安全隐患

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104102145721.png" alt="image-20220104102145721" style="zoom:50%;" />

**数据链路层设备扩充网络**

网桥或交换机

分隔了冲突域

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104102441166.png" alt="image-20220104102441166" style="zoom:50%;" />

理想的网桥是透明

即插即用，无需任何配置

网络中的站点无需感知网桥的存在与否

##### ❗MAC地址表的构建——逆向学习源地址

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104104035005.png" alt="image-20220104104035005" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104104059300.png" alt="image-20220104104059300" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104104118284.png" alt="image-20220104104118284" style="zoom:50%;" />

**总结：**

**增加表项：帧的源地址对应的项不在表中**

**删除表项：老化时间到期**

**更新表项：帧的源地址在表中，更新时间戳**



**网桥通过逆向学习帧的源地址：**

**获取主机所处的位置**

**构建MAC地址表**



##### 网桥对于入境帧的处理过程（forwarding\filtering\flooding)

**Forwarding（转发）**

逆向学习源地址，并根据目的地址查询MAC地址表

MAC地址表完善时

找到匹配项，从对应端口转发出去

**Filtering（过滤）**

逆向学习源地址，并根据目的地址查询MAC地址表

MAC地址表完善时

入境口=出境口，丢弃

**Flooding（泛洪）**

逆向学习源地址，并根据目的地址查询MAC地址表

MAC地址表不完善时

找不到匹配项，从所有端口（除了入境口）发送出去

​	存在的问题：**一个网段的数据被发送到无关网段，存在安全隐患，浪费网络资源）**

​	**两种目的地址的帧，需要泛洪（泛洪的两种情形）:**

​		广播帧

​		未知单播帧（目的地址不在MAC地址转发表中的单播数据帧）

**小结**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104105948603.png" alt="image-20220104105948603" style="zoom:50%;" />

## ✨❗第五章 网络层

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104110118842.png" alt="image-20220104110118842" style="zoom:50%;" />

### 网络层服务

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104111100932.png" alt="image-20220104111100932" style="zoom:50%;" />

#### **概述**

**网络层服务的实现**

网络层实现端系统间多跳传输可达

网络层功能存在在每台主机和路由器中

​	发送端：将传输层数据单元**封装**在数据包中

​	接收端：解析接受的数据包，**取出**传输层数据单元，交付给传输层

​	路由器：检查数据包首部，转发数据包

**传输单位：数据报**

**❗网络层关键功能**

路由（控制面）

​	选择数据包从源端到目的端的路径

​	核心：**路由算法与协议**

转发（数据面）

​	将数据包从路由器的输入接口传送到正确的输出接口

#### ❗无连接服务的实现

无连接服务：不需要提前建立连接

**数据包服务**

​	网络层向上只提供简单灵活无连接的、尽最大努力交付的数据包服务

​	发送分组时不需要先建立连接，每个分组单独发送

​	数据包独立转发，相同源-目的的数据包可能经过不同的路径

​	**网络层不提供服务质量的交付**

**尽力而为交付**

​	传输网络不提供端到端的可靠传输服务：丢包、乱序、错误

​	优点：**网络的造价大大降低，运行方式灵活，能够适应多种应用**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104112251961.png" alt="image-20220104112251961" style="zoom:50%;" />

### ❗Internet网络协议

#### ❗IPv4协议（需要掌握报文结构）

即网络协议版本4，一种无连接的协议，是互联网的核心，也是使用最广泛的网络协议版本，其后继版本为IPv6

**Internet协议执行两个基本功能**

​	寻址

​	分片

❗IPv4数据包格式

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104132648966.png" alt="image-20220104132648966" style="zoom:50%;" />

片偏移：单位为8B

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104132659449.png" alt="image-20220104132659449" style="zoom:50%;" />

**数据部分是传输层的报文段**

#### 数据包分片

MTU：最大传输单元，链路层数据帧可封装数据上限

​	链路MTU

​	路径MTU

分片策略

​	允许途中分片：根据下一跳链路的MTU实施分片

​	不允许途中分片：发出的数据包长度小于路径MTU（路径MTU发现机制）

重组策略

​	途中重组，实施难度太大

​	目的端重组（互联网采用的策略）

​	重组所需信息：原始数据包编号、分片偏移量、是否收集所有分片<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104144418120.png" alt="image-20220104144418120" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104144454143.png" alt="image-20220104144454143" style="zoom:50%;" />

#### IP协议功能及报头字段总结

**网络层基本功能**

支持多跳讯录将IP数据包送达目的端：目的IP地址

表明发送端身份：源IP地址

根据IP头部协议类型，提交给不同上层协议处理：协议

**其他相关问题**

数据包长度大于传输链路的MTU的问题，通过分片机制解决：标识、分片、片偏移

防止循环转发浪费网络资源（路由错误、设备故障等），通过跳数限制解决：生存时间TTL

IP包头错误导致无效传输，通过头部机校验解决：首部校验和

#### IP地址

IP地址，网络上的每一台主机（或路由器）的每一个端口都会分配一个全球唯一的32位标识符

将IP地址划分为固定的类，每一类都由两个字段组成

网络号相同的这块连续IP地址空间称为地址的前缀，或网络前缀

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104151152845.png" alt="image-20220104151152845" style="zoom:50%;" />

#### ❗分类的IP地址

IP地址共分为A、B、C、D五类，A类、B类、C类为单播地址

IP地址的书写采用**点分十进制法**，其中每一段取值范围为0到255

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104151432090.png" alt="image-20220104151432090" style="zoom:50%;" />

**IP特殊地址**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104151510283.png" alt="image-20220104151510283" style="zoom:50%;" />

#### ❗子网划分

**作用**

减少了IP地址的浪费

网络的组织更加灵活

便于维护和管理

![image-20220104160821107](C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104160821107.png)

#### ❗无类域间路由CIDR

**消除了传统的A/B/C类地址以及划分子网的概念**

网络前缀+主机号

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104161746891.png" alt="image-20220104161746891" style="zoom:50%;" />

**融合子网地址和子网掩码，方便子网划分**

网络前缀都相同的连续IP地址块组成一个CIDR地址块

一个CIDR地址快可以表示很多地址，这种地址的聚合常称为**路由聚合**，也成为**构成超网**

聚合技术在Internet中大量使用，它允许前缀重叠，数据包按具体路由的方向发送，即具有最少IP地址的最长匹配前缀

**❗最长前缀匹配**

![image-20220104163603162](C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104163603162.png)

#### IP包转发

间接交付：与目的主机不在同一个IP子网内<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104164718109.png" alt="image-20220104164718109" style="zoom:50%;" />

#### IP地址与MAC地址

IP地址放在IP数据包的首部，而硬件地址则放在MAC帧的首部

IP数据包经过不同链路时，IP数据包中封装的IP地址不发生改变，而MAC帧中的硬件地址是发生改变的

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104165926681.png" alt="image-20220104165926681" style="zoom:50%;" />

#### ARP地址解析协议

**IP数据包转发：从主机A到主机B**

1. 检查目的IP地址的网络号部分
2. 确定主机B与主机A属相同IP网络
3. 将IP数据包封装到链路层帧中，直接发送给主机B**（加上MAC头部）**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104170306330.png" alt="image-20220104170306330" style="zoom:50%;" />

**已知B的IP地址，如何获取B的MAC地址？**

1. 如果A的ARP表中缓存有B的IP地址与MAC地址的映射关系，则直接从ARP表获取

2. 如果没有，则A广播包含B的ARP query分组

   （在局域网上的所有节点都可以收到ARP query）

3. B接收到ARP query分组后，将自己的MAC地址发送给A

4. A在ARP表中缓存B的IP地址和MAC地址的映射关系（超时删除）

![image-20220104170628391](C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104170628391.png)

#### 路由到另一个局域网

例：A->R->E

1. A创建数据包（网路层）
2. 在源主机A的**路由表**中找到路由器R的IP地址
3. A根据R的IP地址223.1.1.4，使用**ARP协议**获得R的MAC地址
4. A创建数据帧（链路层，目的地址为R的MAC地址）
5. 数据帧中封装A到E的IP数据包
6. A发送数据帧，R接收数据帧

#### 网络地址转换NAT

用于解决IPv4地址不足的问题**（路由器对目的地址是私有IP地址的数据报都不会进行转发）**，是一种将私有（保留）地址转化为公有IP地址的转换技术

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104171648517.png" alt="image-20220104171648517" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104172153848.png" alt="image-20220104172153848" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104172207280.png" alt="image-20220104172207280" style="zoom:50%;" />

NAT根据不同的IP上层协议进行NAT表项管理：TCP/UDP/ICMP

传输层TCP/UDP拥有16-bit端口号字段

​	所以一个WAN测地址可以支持60,000个并行连接

**NAT的优势**

1. 节省合法地址，减少地址冲突
2. 灵活连接Internet
3. 保护局域网私密性

**问题或缺点**

1. 违反了IP的结构模型，路由处理传输层协议
2. 违反了端到端的原则
3. 违反了最基本的协议分层规则
4. 新型网络应用的设计者必须要考虑NAT场景，如P2P应用程序

#### IPv4地址如何获取

公有IP地址要求全球唯一

​	ICANN即互联网名字与编号分配机构向ISP分配，ISP再向所属机构或组织逐级分配

**静态设定**

​	申请固定IP地址，手工设定，如路由器，服务器

**动态获取**

​	使用DHCP协议或其他动态配置协议

​	当主机加入IP网络，允许主机从DHCP服务器动态获取IP地址

​	可以有效利用IP地址，方便移动主机的地址获取

#### DHCP动态主机配置协议

当主机加入IP网络，允许主机从DHCP服务器动态获取IP地址

可以有效利用IP地址，方便移动主机的地址获取

工作模式：C/S

基于UDP工作

**工作过程**

1. 主机广播DHCP**发现**报文

   主机试图找到网络中的服务器，服务器获得一个IP地址

2. DHCP服务器广播DHCP**提供**报文

   服务器拟分配给主机一个IP地址及相关配置，先到先得

3. 主机广播DHCP**请求**报文

   主机向服务器请求提供IP地址

4. DHCP服务器广播DHCP**确认**报文

   地址分配给主机

#### ICMP协议

**为了更加有效地转发IP数据报和提高交付成功的机会**

ICMP：互联网控制报文协议

​	ICMP允许主机或路由器差错报告情况和提供有关异常情况的报告

​	由主机和路由器用于网络层信息的通信

​	ICMP报文携带在IP数据报中（IP数据报的数据部分）：IP上层协议号为1

**ICMP报文类型**

**差错报告报文**

终点不可达：不可达主机、不可达网络、无效端口、协议

**询问报文**

回送请求/回答（ping）

**ICMP的应用**

**Ping**

测试两个主机之间的连通性

使用了ICMP回送请求与回送回答报文

**Traceroute**

TraceRT命令

跟踪一个分组从源点到终点的路径 

使用了ICMP时间超过差错报文

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104184308386.png" alt="image-20220104184308386" style="zoom:50%;" />

停止条件

​	UDP段最终到达目的主机

​	目的地返回ICMP”端口不可达“分组

​	当源得到该ICMP，停止

### 路由算法

**路由算法必须满足的特性**

正确性 简单性 鲁棒性 稳定性 公平性

**根据路由算法是否随网络的通信量或拓扑自适应划分**

静态路由选择策略（非自适应路由选择）

​	管理员手工配置路由信息

​	路由更新慢，不适用大型网络

动态路由选择策略（自适应路由选择）

​	路由器之间彼此交换信息

​	算法复杂，增加网络复旦

​	**全局性**

​		链路状态路由算法 OSPF

​		所有路由器掌握完整的网络拓扑和链路费用信息

​	**分散性**

​		距离向量路由算法 RIP

​		路由器只掌握物理相连的邻居及链路费用

#### 优化原则

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104190536403.png" alt="image-20220104190536403" style="zoom:50%;" />



#### ❗🍒距离向量路由（DV）

![image-20220104194634242](C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104194634242.png)

**例题**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104195532813.png" alt="image-20220104195532813" style="zoom:50%;" />

**好消息传得快，坏消息传得慢**

![image-20220104201930981](C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104201930981.png)

#### ❗🍒链路状态路由（LS）

1. 发现邻居，了解他们的网络地址

2. 设置到每个邻居的成本度量

   <img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104204705809.png" alt="image-20220104204705809" style="zoom:50%;" />

3. 构造一个分组（LSP，链路状态分组），分组中包含刚收到的所有信息

   <img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104204553432.png" alt="image-20220104204553432" style="zoom:50%;" />

   

4. 将此分组发送给其他的路由器

   <img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104204649238.png" alt="image-20220104204649238" style="zoom:50%;" />

5. 计算到其他路由器的最短路径

   <img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104204727520.png" alt="image-20220104204727520" style="zoom:50%;" />

#### 两种算法的比较

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104205419244.png" alt="image-20220104205419244" style="zoom:50%;" />

### Internet路由协议

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104191700228.png" alt="image-20220104191700228" style="zoom:50%;" />

#### OSPF 开放最短路径优先协议

1989年开发

采用分布式的**链路状态算法**

**基本思想**

**和谁交换：**向本自治系统中所有路由器**洪泛信息** （但其实是每个向相邻的发）

**交换什么：**发送的信息就是与本路由器相邻的所有路由器的链路状态

**多久交换：**只有当链路状态发生变化时路由器才用洪泛法发送此信息

**链路状态**

说明本路由器都和哪些路由器相邻，以及该链路的**度量**（一般包括费用、距离、时延、带宽等）

由于各路由器之间频繁地交换链路状态信息，因此所有的路由器最终都能建立一个链路状态数据库LSDB

这个数据库实际上就是区域内的拓扑结构图，它在区域内时一致的（这成为链路状态数据库的同步）

**区域的概念**

OSPF支持将一组网段组合在一起，称为一个区域

详细描述拓扑结构的链路状态信息尽在区域内传递，区域间传递的是抽象的路由信息

使用层次结构的区域划分，上层的区域叫做主干区域，其他区域都必须与主干区域相连

非主干区域之间不允许直接发布区域间路由信息

区域也不能泰达，在一个区域内的路由器最好不超过200个

划分区域可以缩小LSDB的规模，减少网络流量

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104203532160.png" alt="image-20220104203532160" style="zoom:50%;" />

#### RIP 路由选择协议

基于距离向量的路由选择协议，**简单**

使用**跳数**衡量到达目的网络的距离

​	RIP认为一个好的路由就是她通过的路由的数目少，即“距离短”

​	RIP允许一条路径最多只能包含**15**个路由器

RIP协议的基本思想

​	仅和相邻路由器交换信息

​	交换的内容是自己的路由表

​	周期性更新：**30s**

**工作过程**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104193953187.png" alt="image-20220104193953187" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104194006273.png" alt="image-20220104194006273" style="zoom:50%;" />

#### BGP 外部网关路由协议

目前互联网中唯一实际运行的自治域间的路由协议

**功能**

eBGP：从相邻的AS获得**网络可达信息**（到达某个网络所要经过的一系列AS）

iBGP：将网络可达信息传播给AS内的路由器

基于网络可达信息和策略决定到其他的网络的“最优”路由

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104210209764.png" alt="image-20220104210209764" style="zoom:50%;" />

**BGP会话**

两个BGP路由器通过TCP连接交换BGP报文

（通告到不同网络前缀的路径，即路径向量协议）

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104210413161.png" alt="image-20220104210413161" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104210504499.png" alt="image-20220104210504499" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104210520975.png" alt="image-20220104210520975" style="zoom:50%;" />

**BGP协议特点**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104210554694.png" alt="image-20220104210554694" style="zoom:50%;" />

#### 三种路由协议比较

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104211229272.png" alt="image-20220104211229272" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220104211336008.png" alt="image-20220104211336008" style="zoom:50%;" />

## ✨第六章 传输层

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105093728110.png" alt="image-20220105093728110" style="zoom:50%;" />

### 传输层复用和分用

**套接字：即为socket接口**

传输层基本服务：将主机间交付扩展到进程间交付，通过复用和分用实现

**传输单元：报文段**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105093909682.png" alt="image-20220105093909682" style="zoom:50%;" />

**如何进行复用和分用**

主机中每个套接字应分配一个唯一的标识

报文段中包含接收套接字的标识

复用：发送方传输从将套接字标识置于报文段中，交给网络层

分用：接收方传输层根据报文段中的套接字标识，将报文段交付到正确的套接字

**套接字标识与端口号**

端口号是套接字标识的一部分：

​	每个套接字在本地关联一个端口号

​	端口号是一个16bit的数

端口号的分类：

​	熟知端口：0-1023，由公共域协议使用

​	注册端口：1024-49151，需要向IANA注册才能使用

​	动态和/或私有端口：49152-65535，一般程序使用

报文段中有两个字段携带端口号

​	源端口号：与发送进程关联的本地端口号

​	目的端口号：与接收进程关联的本地端口号

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105095259841.png" alt="image-20220105095259841" style="zoom:50%;" />

**套接字端口号的分配**

**自动分配：**

创建套接字时不指定端口号

由操作系统从49152-65535中分配

**客户端**通常使用这种方法

**使用指定端口号创建套接字：**

创建套接字时指定端口号

实现公共域协议的服务器应分配众所周知的端口号（0-1023）

**服务器**通常采用这种方法

#### UDP分用的方法

UDP套接字使用<IP地址,端口号>二元组进行标识

接收方传输层收到一个UDP报文段后：

​	检查报文段中的目的端口号，将UDP报文段交付到具有该端口号的套接字

​	<目的IP地址，目的端口号>相同的UDP报文段被交付给同一个套接字，与源地址和端口号无关

​	报文段中的<源IP地址，源端口号>被接收进程用来发送响应报文

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105095955351.png" alt="image-20220105095955351" style="zoom:50%;" />

#### TCP服务器使用的套接字

一个TCP服务器为了同时服务很多个客户，使用两种套接字

**监听套接字：**

​	服务器平时在监听套接字上等待服务的连接请求，该套接字具有众所周知的端口号

**连接套接字：**

​	服务器在收到客户的连接请求后，创建一个连接套接字，使用临时分配的端口号

​	服务器同时创建一个新的进程，在该连接套接字上服务该客户

​	**每个连接套接字只与一个客户通信**，即只接受具有以下四元组的报文段：

​		源IP地址=客户IP地址，源端口号=客户套接字端口号

​		目的地址=服务器IP地址，目的端口号=服务器监听套接字的端口号

​	**连接套接字需要使用<源IP地址，目的IP地址，源端口号，目的端口号>四元组进行标识，服务器使用该四元组将TCP报文段交付到正确的连接套接字**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105102139796.png" alt="image-20220105102139796" style="zoom:50%;" />

**小结**

**UDP套接字**

使用<IP地址，端口号>二元组标识UDP套接字

服务器使用**一个套接字**服务所有客户

**TCP套接字**

使用<源IP地址，目的IP地址，源端口号，目的端口号>四元组标识连接套接字

服务器使用**一个监听套接字和多个连接套接字**服务多个客户，每个连接套接字服务一个客户

### 无连接传输：UDP

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105104104937.png" alt="image-20220105104104937" style="zoom:50%;" />

#### UDP提供的服务

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105102446245.png" alt="image-20220105102446245" style="zoom:50%;" />

#### UDP报文结构

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105102541945.png" alt="image-20220105102541945" style="zoom:50%;" />

#### UDP校验和

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105102706884.png" alt="image-20220105102706884" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105102719888.png" alt="image-20220105102719888" style="zoom:50%;" />

#### 为什么需要UDP?

应用可以尽可能快地发送报文：

​	无建立连接的延迟

​	不限制发送速率（不进行拥塞控制和流量控制）

包头开销小

协议处理简单

#### UDP适合哪些应用？

容忍丢包但对延迟敏感的应用：如流媒体

以单次请求/响应为主的应用：如DNS

若应用要求基于UDP进行可靠传输：由应用层实现可靠性

### 面向连接的传输：TCP

#### TCP概述

**TCP服务模型：**

​	在一对通信的进程之间提供一条理想的字节流通道

**点到点通信：**

​	仅涉及一对通信进程

**全双工：**

​	可以同时双向传输数据

**可靠、有序的字节流：**

​	不保留报文边界

**需要的机制**：

1. 建立连接

   通信双方为本次通信建立数据传输所需的状态（套接字、缓存、变量等）

2. 可靠数据传输

   流水线式发送，报文段检错，丢失重传

3. 流量控制

   发送方不会令接收方缓存溢出

#### ❗TCP报文段结构

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105110513663.png" alt="image-20220105110513663" style="zoom:50%;" />

**最大段长度（MSS）**

​	位于可选字段

​	TCP段中可以携带的最大数据字节数

​	建立连接时，每个主机可声明自己能够接受的MSS，缺省为536字节

**选择确认（SACK)**

​	最初的TCP协议只使用累积确认

​	改进的TCP协议引入选择确认，允许接收端指出缺失的数据字节

**发送序号和确认序号的含义**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105110754107.png" alt="image-20220105110754107" style="zoom:50%;" />

**举例**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105110847964.png" alt="image-20220105110847964" style="zoom:50%;" />

#### **TCP可靠数据传输**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105111230022.png" alt="image-20220105111230022" style="zoom:50%;" />

**一个高度简化的TCP协议**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105111322475.png" alt="image-20220105111322475" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105111841307.png" alt="image-20220105111841307" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105111856857.png" alt="image-20220105111856857" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105113440013.png" alt="image-20220105113440013" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105113536764.png" alt="image-20220105113536764" style="zoom:50%;" />

##### 快速重传

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105113827517.png" alt="image-20220105113827517" style="zoom:50%;" />

**小结**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105113843310.png" alt="image-20220105113843310" style="zoom:50%;" />



#### ❗TCP连接管理（重点：三次握手）

**建立TCP连接需要确定两件事：**

​	双方都同意

​	初始化连接参数（序号，MSS等）

**两次握手**

意外问题：

​	报文传输延迟变化很大

​	存在重传的报文段

​	存在报文重排序

失败案例：

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105132854908.png" alt="image-20220105132854908" style="zoom:50%;" />

❗**三次握手建立连接**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105133043452.png" alt="image-20220105133043452" style="zoom: 50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105133112269.png" alt="image-20220105133112269" style="zoom:50%;" />

**如何选择起始序号**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105133328610.png" alt="image-20220105133328610" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105133345437.png" alt="image-20220105133345437" style="zoom:50%;" />

**关闭TCP连接**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105133449076.png" alt="image-20220105133449076" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105133500477.png" alt="image-20220105133500477" style="zoom:50%;" />

#### 网络拥塞

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105133831277.png" alt="image-20220105133831277" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105133841244.png" alt="image-20220105133841244" style="zoom:50%;" />

#### TCP流量控制

**滑动窗口**

发送方的发送窗口取决于接收窗口rwnd和拥塞窗口cwnd的最小值 

**接收窗口=接收缓存-[最近接收-最近确认]=接收缓存-已接收未确认**

**拥塞窗口>=最近发送-最近收到确认=已发送未确认**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105124616886.png" alt="image-20220105124616886" style="zoom:50%;" />

##### 🍒为什么回退N、选择重传和UDP不需要流量控制

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105124715803.png" alt="image-20220105124715803" style="zoom:50%;" />

**非零窗口通告**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105130931772.png" alt="image-20220105130931772" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105131816674.png" alt="image-20220105131816674" style="zoom:50%;" />

**糊涂窗口综合症**

当数据的发送速度很快、而消费速度很慢时，零窗口探测带来的问题：

​	接收方不断发送微笑窗口通告

​	发送方不断发送很小的数据分组

​	大量带宽被浪费

**解决方案**：

**接收方启发式策略**

通告零窗口之后，**仅当窗口大小显著增加（窗口大小达到缓存空间的一半或者一个MSS，取两者最小值）后**才发送更新的窗口通告

当窗口大小不满足以上策略时，推迟发送确认（最多500ms，且至少每隔一个报文段使用正常方式进行确认），寄希望于推迟间隔内由更多数据被消费

**发送方启发式策略**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105132541808.png" alt="image-20220105132541808" style="zoom:50%;" />

**小结**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105125008204.png" alt="image-20220105125008204" style="zoom:50%;" />

#### TCP拥塞控制

**TCP使用端到端拥塞控制机制：**

**发送方根据自己感知的网络拥塞程度，限制其发送速率**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105133908991.png" alt="image-20220105133908991" style="zoom:50%;" />



**❗拥塞窗口的调节策略**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105133924795.png" alt="image-20220105133924795" style="zoom:50%;" />

**TCP慢启动**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105143055015.png" alt="image-20220105143055015" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105143243293.png" alt="image-20220105143243293" style="zoom:50%;" />

**区分不同的丢包事件**

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105143557570.png" alt="image-20220105143557570" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105143610493.png" alt="image-20220105143610493" style="zoom:50%;" />

<img src="C:\Users\陈友谅\AppData\Roaming\Typora\typora-user-images\image-20220105143756549.png" alt="image-20220105143756549" style="zoom:50%;" />

